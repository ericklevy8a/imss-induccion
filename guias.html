<!doctype html>
<html>

<head>

    <meta charset="UTF-8">
    <title>IMSS - Inducción al área y al puesto - Guías</title>
    <link rel="shortcut icon" type="image/x-icon" href="ico/imss.ico" />
    <link rel="stylesheet" type="text/css" href="css/style.css">

</head>

<body>

    <div class="container">

        <header></header>

        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="guias.html" class="active">Guías</a></li>
                <li><a href="avances.html">Avances</a></li>
                <li><a href="material.html">Material</a></li>
                <li><a href="contacto.html">Contacto</a></li>
            </ul>
        </nav>

        <main>

            <h1>Programa de inducción al área y al puesto</h1>

            <article>

                <h2>Guías de inducción al área y al puesto</h2>
                <p>Los órganos normativos verificarán que las acciones de inducción al área y al puesto sean
                    proporcionadas al personal de reciente contratación, por el jefe inmediato superior o quien éste
                    designe, utilizando la “Guía de Inducción al área y al puesto”. (Formato normado de una hoja),
                    dentro de los 5 días hábiles.</p>

            </article>

            <article class="sidenote">

                <h2>Descargas</h2>

                <hr>

                <p><strong>Guía de inducción al área y al puesto (pre-llenada)</strong>
                    <br>Formato de archivo: PDF
                </p>
                <input type="search" name="matricula" id="matricula" maxlength="9" placeholder="Matrícula" required />
                <button id="buscar" class="download">Buscar</button>
                <div id="respuesta"></div>
                <div id="guias"></div>

                <hr>

                <p><strong>Guía de inducción al área y al puesto (en blanco)</strong>
                    <br>Formato de archivo: PDF
                </p>
                <a class="download" href="docs/guia-induccion-blanco.pdf" target="_blank">Descargar</a>

                <hr>

                <p><strong>Instructivo de llenado</strong>
                    <br>Formato de archivo: PDF
                </p>
                <a class="download" href="docs/guia-induccion-ayuda.pdf" target="_blank">Descargar</a>

                <hr>

                <a class="get-adobe" href="https://get.adobe.com/es/reader/" target="_blank"><img
                        src="img/Get-Adobe-Acrobat-Reader-badge.png"></a>

            </article>

        </main>

        <footer>
            <p>Zaragoza No. 62, Col. Centro, C.P. 28000, Colima, Col. Tel. 312 312 6959</p>
        </footer>

    </div>

    <!-- Codigo para manejar la busqueda y despliegue de guias prellenadas -->
    <script>

        //
        // SCRIPT PARA LA GENERACION DE GUIAS DE INDUCCION PRE-LLENADAS
        //

        // Referencias a objetos del DOM
        const txtMatricula = document.getElementById('matricula');
        const btnBuscar = document.getElementById('buscar');
        const divRespuesta = document.getElementById('respuesta');
        const divGuias = document.getElementById('guias');

        // Manejador del cambio de matrícula
        txtMatricula.oninput = function () {
            // Habilitar boton de buscar
            btnBuscar.removeAttribute('disabled');
            // Eliminar mensajes y tabla
            divRespuesta.innerHTML = '';
            divGuias.innerHTML = '';
        }

        // Manejador de la tecla enter dentro del cuadro de texto
        txtMatricula.onkeypress = function (evt) {
            if (evt.key === "Enter") {
                evt.preventDefault();
                btnBuscar.click();
            }
        }

        // Manejador del click de buscar
        btnBuscar.onclick = function () {
            // Deshabilitar boton de buscar
            btnBuscar.setAttribute('disabled', 'disabled');
            // Validar valor de matrícula
            const matricula = txtMatricula.value;
            const regex = new RegExp('^[0-9]{7,9}$');
            const valid = regex.test(matricula);
            if (valid) {
                // Buscar guias
                fetchData(matricula);
            } else {
                // Desplegar error
                let html = '<span class="msg-bar msg-warn">';
                html += 'Se debe especificar una matrícula de trabajador válida!';
                html += '</span>';
                divRespuesta.innerHTML = html;
            }
        }

        // Buscar guias de induccion para una matrícula dada
        function fetchData(matricula) {
            const url = 'get_guias.php?matricula=' + encodeURI(matricula);
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (data.length === 0) {
                        let html = '<span class="msg-bar msg-info">';
                        html += 'No se encontraron guías de inducciones para esa matrícula!';
                        html += '</span>';
                        divRespuesta.innerHTML = html;
                        return;
                    }
                    showTable(data);
                })
                .catch(err => {
                    let html = '<span class="msg-bar msg-error">';
                    html += 'Ocurrió un error desconocido!';
                    html += '</span>';
                    divRespuesta.innerHTML = html;
                    throw err;
                });
        }

        // Desplegar tabla de inducciones
        function showTable(data) {
            let html = '<span class="msg-bar msg-info">';
            html += 'Se han encontrado guías de inducciones pendientes:';
            html += '</span>';
            divRespuesta.innerHTML = html;
            html = '<table class="inducciones">';
            html += '<tr>';
            html += '<th>Fecha</th>';
            html += '<th>Adscripción</th>';
            html += '<th>Categoría</th>';
            html += '<th>Acciones</th>';
            html += '</tr>';
            for (let r = 0; r < data.length; r++) {
                const url = makeURL(data[r]);
                html += '<tr>';
                html += `<td>${data[r]['Quincena']}</td>`;
                html += `<td>${data[r]['Adscripción']}</td>`;
                html += `<td>${data[r]['Categoría']}</td>`;
                html += `<td><a class="download ver" href="${url}" target="_blank">Ver</a></td>`;
                html += '</tr>';
            }
            html += '</table>';
            divGuias.innerHTML = html;
        }

        // Formar enlaces al generador de PDF con los datos de la guía
        function makeURL(row) {
            let url = 'getpdf.php';
            url += '?ADSCRIPCION=' + encodeURI(row['Adscripción']);
            url += '&NOMBRE_UNIDAD=' + encodeURI(row['Adscripción']);
            url += '&CATEGORIA=' + encodeURI(row['Categoría']);
            url += '&MATRICULA=' + encodeURI(row['Matrícula']);
            url += '&NOMBRE_TRABAJADOR=' + encodeURI(row['Nombre']);
            url += '&FECHA_INGRESO=' + encodeURI(row['Quincena']);
            url += '&TIPO_COMPUESTO=' + encodeURI(row['Tipo Compuesto']);
            return url;
        }

    </script>

</body>

</html>